<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug User Flow</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 20px; }
        .result { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .highlight { background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin: 20px 0; }
        .debug-section { border: 1px solid #ddd; padding: 15px; margin: 15px 0; border-radius: 8px; }
        iframe { border: 2px solid #007bff; border-radius: 8px; width: 100%; height: 600px; margin: 20px 0; }
        .rendered-content { border: 2px solid #28a745; padding: 15px; margin: 10px 0; background: #f8f9fa; }
        pre { background: #f1f1f1; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” User Flow Debug - Missing Buttons</h1>

    <div class="highlight">
        <h3>ğŸ› Issue:</h3>
        <p>User reports: "Triage1 text shows correctly but no buttons to select"</p>
        <p><strong>Expected:</strong> Yes/No buttons for "Is the patient comatose?"</p>
        <p><strong>Actual:</strong> Only text, no interactive buttons</p>
    </div>

    <div id="results"></div>

    <div class="debug-section">
        <h2>ğŸ§ª Simulated User Flow</h2>
        <div id="simulatedApp"></div>
    </div>

    <div class="debug-section">
        <h2>ğŸ“º Actual Application</h2>
        <iframe src="/0925/" title="Actual iGFAP Application"></iframe>
    </div>

    <script type="module">
        const results = document.getElementById('results');
        const simulatedApp = document.getElementById('simulatedApp');

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
            console.log(message);
        }

        async function debugUserFlow() {
            try {
                addResult('ğŸ”„ Starting user flow simulation...', 'info');

                // Step 1: Initialize the app components
                addResult('<strong>Step 1: Loading Core Components</strong>', 'info');

                const { store } = await import('./src/state/store.js');
                const { render } = await import('./src/ui/render.js');
                const { renderTriage1 } = await import('./src/ui/screens/triage1.js');
                addResult('âœ… Core components loaded', 'success');

                // Step 2: Check current state
                addResult('<strong>Step 2: Checking Application State</strong>', 'info');
                const state = store.getState();
                addResult(`ğŸ“Š Current screen: ${state.currentScreen}`, 'info');

                // Step 3: Test triage1 rendering directly
                addResult('<strong>Step 3: Testing Triage1 Rendering</strong>', 'info');
                const triage1Html = renderTriage1();
                addResult(`ğŸ“Š Generated HTML length: ${triage1Html.length} characters`, 'info');

                // Show the actual HTML being generated
                const htmlPreview = document.createElement('div');
                htmlPreview.className = 'rendered-content';
                htmlPreview.innerHTML = '<h4>Generated HTML:</h4><pre>' +
                    triage1Html.replace(/</g, '&lt;').replace(/>/g, '&gt;') + '</pre>';
                results.appendChild(htmlPreview);

                // Step 4: Check for buttons in the HTML
                addResult('<strong>Step 4: Analyzing Button Elements</strong>', 'info');
                const buttonMatches = triage1Html.match(/data-action="triage1"/g);
                const buttonCount = buttonMatches ? buttonMatches.length : 0;
                addResult(`ğŸ“Š Buttons found in HTML: ${buttonCount}`, buttonCount > 0 ? 'success' : 'error');

                if (buttonCount === 0) {
                    addResult('ğŸš¨ PROBLEM IDENTIFIED: No buttons in generated HTML!', 'error');
                }

                // Step 5: Test localization
                addResult('<strong>Step 5: Testing Localization</strong>', 'info');
                const { t } = await import('./src/localization/i18n.js');

                const triage1Title = t('triage1Title');
                const triage1Question = t('triage1Question');
                const triage1Yes = t('triage1Yes');
                const triage1No = t('triage1No');

                addResult(`ğŸ“Š triage1Title: "${triage1Title}"`, 'info');
                addResult(`ğŸ“Š triage1Question: "${triage1Question}"`, 'info');
                addResult(`ğŸ“Š triage1Yes: "${triage1Yes}"`, 'info');
                addResult(`ğŸ“Š triage1No: "${triage1No}"`, 'info');

                if (!triage1Yes || !triage1No || triage1Yes === 'triage1Yes' || triage1No === 'triage1No') {
                    addResult('ğŸš¨ PROBLEM: Localization not working for button text!', 'error');
                }

                // Step 6: Simulate full render
                addResult('<strong>Step 6: Simulating Full Render Process</strong>', 'info');

                // Create a mock container
                const mockContainer = document.createElement('div');
                mockContainer.id = 'mockAppContainer';

                try {
                    // Force navigate to triage1 if not already there
                    if (state.currentScreen !== 'triage1') {
                        store.navigate('triage1');
                        addResult('ğŸ“ Navigated to triage1', 'info');
                    }

                    // Simulate the render function
                    render(mockContainer);
                    addResult('âœ… Render function executed', 'success');

                    // Check what was actually rendered
                    const renderedButtons = mockContainer.querySelectorAll('[data-action="triage1"]');
                    addResult(`ğŸ“Š Buttons in rendered DOM: ${renderedButtons.length}`, renderedButtons.length > 0 ? 'success' : 'error');

                    // Show the actual rendered content
                    simulatedApp.innerHTML = '<h4>Simulated App Content:</h4>' + mockContainer.innerHTML;

                    if (renderedButtons.length === 0) {
                        addResult('ğŸ” Checking for any buttons at all...', 'info');
                        const allButtons = mockContainer.querySelectorAll('button');
                        addResult(`ğŸ“Š Total buttons found: ${allButtons.length}`, 'info');
                    }

                } catch (renderError) {
                    addResult(`âŒ Render error: ${renderError.message}`, 'error');
                    console.error('Render error details:', renderError);
                }

                addResult('ğŸ¯ User flow simulation complete!', 'success');

            } catch (error) {
                addResult(`âŒ Fatal error: ${error.message}`, 'error');
                console.error('Debug error:', error);
            }
        }

        // Start the debug process
        debugUserFlow();
    </script>
</body>
</html>