<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ICH Prediction Tool</title>
  <style>
    :root {
      --primary-color: #007bff;
      --primary-hover: #0056b3;
      --background-color: #f8f9fa;
      --container-bg: #ffffff;
      --text-color: #333;
      --result-high-bg: #f8d7da;
      --result-high-text: #721c24;
      --result-high-border: #f5c6cb;
      --result-low-bg: #d4edda;
      --result-low-text: #155724;
      --result-low-border: #c3e6cb;
    }

    body.dark-mode {
      --primary-color: #3399ff;
      --primary-hover: #287ac7;
      --background-color: #333;
      --container-bg: #444;
      --text-color: #f8f9fa;
      --result-high-bg: #5c2a30;
      --result-high-text: #f5c6cb;
      --result-high-border: #721c24;
      --result-low-bg: #2a5032;
      --result-low-text: #c3e6cb;
      --result-low-border: #155724;
    }

    *, *::before, *::after { box-sizing: border-box; }
    body { margin: 0; padding: 0; background-color: var(--background-color); color: var(--text-color); font-family: 'Arial', sans-serif; }
    .app-header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: var(--primary-color); color: white; position: fixed; top: 0; left: 0; right: 0; z-index: 999; }
    .app-header h1 { margin: 0; font-size: 1.5em; }
    .header-right { display: flex; align-items: center; gap: 10px; }
    .language-switcher button,
    #darkModeToggle { background: none; border: none; cursor: pointer; padding: 5px; color: white; font-size: 1.2em; }
    .container { max-width: 500px; margin: 70px auto 20px; padding: 20px; background-color: var(--container-bg); border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    h2 { text-align: center; margin-bottom: 20px; }
    .grid-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap: 15px; }
    .input-group, .checkbox-group, .select-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="number"], select { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ccc; border-radius: 5px; background-color: var(--background-color); color: var(--text-color); }
    input:focus, select:focus { border-color: var(--primary-color); outline: none; box-shadow: 0 0 0 3px var(--primary-hover); }
    .checkbox-group { display: flex; align-items: center; }
    .checkbox-group input[type="checkbox"] { margin-right: 8px; width: 18px; height: 18px; }
    button.primary { background-color: var(--primary-color); color: white; border: none; border-radius: 5px; padding: 12px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; transition: background-color 0.3s ease; }
    button.primary:hover { background-color: var(--primary-hover); }
    .result { margin-top: 20px; padding: 15px; border-radius: 8px; text-align: center; border: 1px solid; display: none; }
    .result.high-risk { background-color: var(--result-high-bg); color: var(--result-high-text); border-color: var(--result-high-border); }
    .result.low-risk { background-color: var(--result-low-bg); color: var(--result-low-text); border-color: var(--result-low-border); }
    .result-prob { font-size: 2.5em; font-weight: bold; }
    .result-label { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
    .app-footer { text-align: center; padding: 20px 0; color: var(--secondary-color); }
  </style>
</head>
<body>
  <header class="app-header">
    <h1 id="appTitle">ICH Prediction</h1>
    <div class="header-right">
      <div class="language-switcher">
        <button onclick="switchLanguage('en')" aria-label="Switch to English"><img src="https://flagcdn.com/gb.svg" alt="English"></button>
        <button onclick="switchLanguage('de')" aria-label="Switch to German"><img src="https://flagcdn.com/de.svg" alt="Deutsch"></button>
      </div>
      <button id="darkModeToggle" aria-label="Toggle dark mode">🌙</button>
    </div>
  </header>

  <section class="container">
    <h2 id="strokeModuleTitle">Intracerebral Hemorrhage Prediction</h2>
    <form id="ich-form">
      <div class="grid-container">
        <div class="input-group">
          <label for="age_years" id="ageLabel">Age (years)</label>
          <input type="number" id="age_years" min="18" max="120" step="1" placeholder="e.g., 75" required>
        </div>
        <div class="input-group">
          <label for="systolic_bp" id="sbpLabel">Systolic BP (mmHg)</label>
          <input type="number" id="systolic_bp" min="80" max="300" step="1" placeholder="e.g., 160" required>
        </div>
        <div class="input-group">
          <label for="gfap_value" id="gfapLabel">GFAP Value (pg/mL)</label>
          <input type="number" id="gfap_value" min="29" max="10001" step="0.01" placeholder="e.g., 2875" required>
        </div>

        <!-- Binary features now as checkboxes -->
        <div class="checkbox-group">
          <input type="checkbox" id="eye_deviation">
          <label for="eye_deviation" id="eyeDeviationLabel">Eye Deviation</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="armparese">
          <label for="armparese" id="armpareseLabel">Arm Paresis</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="beinparese">
          <label for="beinparese" id="beinpareseLabel">Leg Paresis</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="atrial_fibrillation">
          <label for="atrial_fibrillation" id="afibLabel">History of Atrial Fibrillation</label>
        </div>
        <div class="checkbox-group">
          <input type="checkbox" id="antiplatelets">
          <label for="antiplatelets" id="antiplateletsLabel">On Antiplatelets</label>
        </div>

        <!-- Tri-state for headache remains a select -->
        <div class="select-group" style="grid-column:1 / -1;">
          <label for="headache" id="headacheLabel">Headache?</label>
          <select id="headache">
            <option value="" disabled selected>Choose…</option>
            <option value="0">No</option>
            <option value="1">Yes</option>
            <option value="-1">Unknown</option>
          </select>
        </div>
      </div>

      <button type="button" id="calculateButton" class="primary" id="calculateButton">Calculate Probability</button>
    </form>

    <div class="result" id="result-container">
      <div class="result-label" id="result-title"></div>
      <div class="result-prob" id="result-probability"></div>
    </div>
  </section>

  <footer class="app-footer">
    <p>© <span id="currentYear"></span> All rights reserved.</p>
  </footer>

  <script>
    // Model parameters
    const INTERCEPT = -0.72549447;
    const COEFFICIENTS = { age_years:-0.20927, eye_deviation:-0.26763, armparese:0.11730, beinparese:0.42467, atrial_fibrillation:-0.24687, systolic_bp:0.36337, antiplatelets:-0.52928, gfap_value:0.98846, headache:0.43796 };
    const MEDIANS = { age_years:78.0, eye_deviation:0.0, armparese:1.0, beinparese:1.0, atrial_fibrillation:0.0, systolic_bp:160.0, antiplatelets:0.0, gfap_value:3.78419, headache:0.0 };
    const IQRS    = { age_years:18.0, eye_deviation:1.0, armparese:1.0, beinparese:1.0, atrial_fibrillation:1.0, systolic_bp:41.5, antiplatelets:1.0, gfap_value:0.98704, headache:0.5 };
    const IMPUTED_HEADACHE = 0.0;
    const OPTIMAL_THRESHOLD = 0.61;

    // Translations
    const translations = {
      en:{appTitle:"ICH Prediction", strokeModuleTitle:"Intracerebral Hemorrhage Prediction", ageLabel:"Age (years)", agePlaceholder:"e.g., 75", sbpLabel:"Systolic BP (mmHg)", sbpPlaceholder:"e.g., 160", gfapLabel:"GFAP Value (pg/mL)", gfapPlaceholder:"e.g., 2875", eyeDeviationLabel:"Eye Deviation", armpareseLabel:"Arm Paresis", beinpareseLabel:"Leg Paresis", afibLabel:"History of Atrial Fibrillation", antiplateletsLabel:"On Antiplatelets", headacheLabel:"Headache?", calculateButton:"Calculate Probability", highRisk:"High Risk: ICH Suspected", lowRisk:"Low Risk: ICH Unlikely", darkModeToggleLabelOn:"Switch to Light Mode", darkModeToggleLabelOff:"Switch to Dark Mode"},
      de:{appTitle:"ICB-Vorhersage", strokeModuleTitle:"Vorhersage einer intrazerebralen Blutung", ageLabel:"Alter (Jahre)", agePlaceholder:"z. B. 75", sbpLabel:"Systolischer RR (mmHg)", sbpPlaceholder:"z. B. 160", gfapLabel:"GFAP-Wert (pg/mL)", gfapPlaceholder:"z. B. 2875", eyeDeviationLabel:"Blickdeviation", armpareseLabel:"Armparese", beinpareseLabel:"Beinparese", afibLabel:"Vorhofflimmern-Anamnese", antiplateletsLabel:"Unter TAH", headacheLabel:"Kopfschmerzen?", calculateButton:"Wahrscheinlichkeit berechnen", highRisk:"Hohes Risiko: ICB vermutet", lowRisk:"Geringes Risiko: ICB unwahrscheinlich", darkModeToggleLabelOn:"Heller Modus", darkModeToggleLabelOff:"Dunkler Modus"}
    };

    let currentLang = 'en';

    document.addEventListener('DOMContentLoaded', ()=>{
      document.getElementById('currentYear').textContent = new Date().getFullYear();
      if(localStorage.getItem('darkMode')==='enabled') { document.body.classList.add('dark-mode'); document.getElementById('darkModeToggle').textContent='☀️'; }
      const lang = localStorage.getItem('language')||'en'; switchLanguage(lang);
      document.getElementById('calculateButton').addEventListener('click', calculateProbability);
      document.getElementById('darkModeToggle').addEventListener('click', toggleDarkMode);
    });

    function switchLanguage(lang){
      currentLang=lang; localStorage.setItem('language',lang);
      const t=translations[lang];
      ['appTitle','strokeModuleTitle','ageLabel','sbpLabel','gfapLabel','eyeDeviationLabel','armpareseLabel','beinpareseLabel','afibLabel','antiplateletsLabel','headacheLabel','calculateButton'].forEach(id=>{ const el=document.getElementById(id); if(el) el.textContent=t[id]; });
      document.getElementById('age_years').placeholder = t.agePlaceholder;
      document.getElementById('systolic_bp').placeholder = t.sbpPlaceholder;
      document.getElementById('gfap_value').placeholder = t.gfapPlaceholder;
      const toggle = document.getElementById('darkModeToggle'); toggle.setAttribute('aria-label', document.body.classList.contains('dark-mode') ? t.darkModeToggleLabelOn : t.darkModeToggleLabelOff);
    }

    function toggleDarkMode(){
      document.body.classList.toggle('dark-mode'); const isDark=document.body.classList.contains('dark-mode');
      const toggle=document.getElementById('darkModeToggle'), t=translations[currentLang]; toggle.textContent=isDark?'☀️':'🌙'; toggle.setAttribute('aria-label', isDark? t.darkModeToggleLabelOn: t.darkModeToggleLabelOff);
      localStorage.setItem('darkMode', isDark?'enabled':'disabled');
    }

    function calculateProbability(){
      const form=document.getElementById('ich-form'); if(!form.checkValidity()){ form.reportValidity(); return; }
      let inputs={}; Object.keys(COEFFICIENTS).forEach(key=>{
        if(key==='eye_deviation'||key==='armparese'||key==='beinparese'||key==='atrial_fibrillation'||key==='antiplatelets'){
          inputs[key]= document.getElementById(key).checked ? 1 : 0;
        } else {
          inputs[key]= parseFloat(document.getElementById(key).value);
        }
      });
      if(inputs.headache===-1) inputs.headache=IMPUTED_HEADACHE;
      inputs.gfap_value = Math.log1p(inputs.gfap_value);
      let z=INTERCEPT;
      Object.keys(inputs).forEach(key=>{ const iqr=IQRS[key], val= iqr===0?0:(inputs[key]-MEDIANS[key])/iqr; z+= val*COEFFICIENTS[key]; });
      const prob=1/(1+Math.exp(-z));
      const decision = prob>=OPTIMAL_THRESHOLD?'high-risk':'low-risk';
      displayResults(prob,decision);
    }

    function displayResults(prob,dec){
      const c=document.getElementById('result-container');
      document.getElementById('result-probability').textContent=`${(prob*100).toFixed(1)}%`;
      document.getElementById('result-title').textContent = translations[currentLang][dec==='high-risk'?'highRisk':'lowRisk'];
      c.className=`result ${dec}`; c.style.display='block';
    }
  </script>
</body>
</html>
