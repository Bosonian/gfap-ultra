var U=Object.defineProperty;var q=(o,e,t)=>e in o?U(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var C=(o,e,t)=>q(o,typeof e!="symbol"?e+"":e,t);import{p as H}from"./index-j-et3O4p.js";import{m as g,M as h,a as v,P as O}from"./medical-core-ZlBp7L7T.js";class S{static calculateProbability(e,t){if(!e||!t||e<=0||t<=0)return{probability:0,confidence:0,isValid:!1,reason:"Invalid inputs: age and GFAP required"};if(e<18||e>120)return{probability:0,confidence:0,isValid:!1,reason:`Age ${e} outside valid range (18-120 years)`};try{const i=(e-this.PARAMS.age.mean)/this.PARAMS.age.std,s=(t-this.PARAMS.gfap.mean)/this.PARAMS.gfap.std,r=this.PARAMS.coefficients.intercept+this.PARAMS.coefficients.age*i+this.PARAMS.coefficients.gfap*s,n=1/(1+Math.exp(-r)),a=n*100,c=Math.abs(n-.5)*2,u=this.getRiskCategory(a);return{probability:Math.round(a*10)/10,confidence:Math.round(c*100)/100,logit:Math.round(r*1e3)/1e3,riskCategory:u,scaledInputs:{age:Math.round(i*1e3)/1e3,gfap:Math.round(s*1e3)/1e3},rawInputs:{age:e,gfap:t},isValid:!0,calculationMethod:"logistic_regression_age_gfap"}}catch(i){return{probability:0,confidence:0,isValid:!1,reason:"Calculation error",error:i.message}}}static getRiskCategory(e){return e<10?{level:"very_low",color:"#10b981",label:"Very Low Risk",description:"Minimal ICH likelihood"}:e<25?{level:"low",color:"#84cc16",label:"Low Risk",description:"Below typical threshold"}:e<50?{level:"moderate",color:"#f59e0b",label:"Moderate Risk",description:"Elevated concern"}:e<75?{level:"high",color:"#f97316",label:"High Risk",description:"Significant likelihood"}:{level:"very_high",color:"#dc2626",label:"Very High Risk",description:"Critical ICH probability"}}static compareModels(e,t){if(!e||!t||!t.isValid)return{isValid:!1,reason:"Invalid model results for comparison"};let i=e.probability||0;i<=1&&(i*=100);const s=t.probability||0,r=i-s,n=s>0?r/s*100:0,a=i>s?"main":s>i?"legacy":"equal";let c;const u=Math.abs(r);return u<5?c="strong":u<15?c="moderate":u<30?c="weak":c="poor",{isValid:!0,probabilities:{main:Math.round(i*10)/10,legacy:Math.round(s*10)/10},differences:{absolute:Math.round(r*10)/10,relative:Math.round(n*10)/10},agreement:{level:c,higherRiskModel:a},interpretation:this.getComparisonInterpretation(r,c)}}static getComparisonInterpretation(e,t){const i=Math.abs(e);return t==="strong"?{type:"concordant",message:"Models show strong agreement",implication:"Age and GFAP are primary risk factors"}:i>20?{type:"divergent",message:"Significant model disagreement",implication:"Complex model captures additional risk factors not in age/GFAP"}:{type:"moderate_difference",message:"Models show moderate difference",implication:"Additional factors provide incremental predictive value"}}static runValidationTests(){const t=[{age:65,gfap:100,expected:"low",description:"Younger patient, low GFAP"},{age:75,gfap:500,expected:"moderate",description:"Average age, moderate GFAP"},{age:85,gfap:1e3,expected:"high",description:"Older patient, high GFAP"},{age:70,gfap:2e3,expected:"very_high",description:"High GFAP dominates"},{age:90,gfap:50,expected:"very_low",description:"Low GFAP despite age"}].map(r=>{const n=this.calculateProbability(r.age,r.gfap);return{...r,result:n,passed:n.isValid&&n.riskCategory.level===r.expected}}),i=t.filter(r=>r.passed).length,s=t.length;return{summary:{passed:i,total:s,passRate:Math.round(i/s*100)},details:t}}static getModelMetadata(){return{name:"Legacy ICH Model",type:"Logistic Regression",version:"1.0.0",features:["age","gfap"],performance:{rocAuc:.789,recall:.4,precision:.86,f1Score:.55,specificity:.94},trainingData:{samples:"Historical cohort",dateRange:"Research study period",validation:"Cross-validation"},limitations:["Only uses age and GFAP - ignores clinical symptoms","Lower recall (40%) - misses some ICH cases","No time-to-onset consideration","No blood pressure or medication factors","Simplified feature set for baseline comparison"],purpose:"Research baseline for evaluating complex model improvements"}}}C(S,"PARAMS",{age:{mean:74.59,std:12.75},gfap:{mean:665.23,std:2203.77},coefficients:{intercept:.3248,age:-.2108,gfap:3.1631}});function ne(o){try{const e=(o==null?void 0:o.age_years)||(o==null?void 0:o.age)||null,t=(o==null?void 0:o.gfap_value)||(o==null?void 0:o.gfap)||null;return!e||!t?null:S.calculateProbability(e,t)}catch(e){return null}}class R{static logComparison(e){try{const t={id:this.generateEntryId(),timestamp:new Date().toISOString(),sessionId:this.getSessionId(),...e},i=this.getStoredData();return i.entries.push(t),i.entries.length>this.MAX_ENTRIES&&(i.entries=i.entries.slice(-this.MAX_ENTRIES)),i.lastUpdated=new Date().toISOString(),i.totalComparisons=i.entries.length,localStorage.setItem(this.STORAGE_KEY,JSON.stringify(i)),!0}catch(t){return!1}}static getStoredData(){try{const e=localStorage.getItem(this.STORAGE_KEY);if(!e)return this.createEmptyDataset();const t=JSON.parse(e);return!t.entries||!Array.isArray(t.entries)?this.createEmptyDataset():t}catch(e){return this.createEmptyDataset()}}static createEmptyDataset(){return{version:"1.0.0",created:new Date().toISOString(),lastUpdated:null,totalComparisons:0,entries:[],metadata:{app:"iGFAP Stroke Triage",purpose:"Model comparison research",dataRetention:"Local storage only"}}}static exportAsCSV(){const e=this.getStoredData();if(!e.entries||e.entries.length===0)return"No research data available for export";const t=["timestamp","session_id","age","gfap_value","main_model_probability","main_model_module","legacy_model_probability","legacy_model_confidence","absolute_difference","relative_difference","agreement_level","higher_risk_model"],i=e.entries.map(r=>{var n,a,c,u,E,_,D,f,p,N,P,k,L,$;return[r.timestamp,r.sessionId,((n=r.inputs)==null?void 0:n.age)||"",((a=r.inputs)==null?void 0:a.gfap)||"",((c=r.main)==null?void 0:c.probability)||"",((u=r.main)==null?void 0:u.module)||"",((E=r.legacy)==null?void 0:E.probability)||"",((_=r.legacy)==null?void 0:_.confidence)||"",((f=(D=r.comparison)==null?void 0:D.differences)==null?void 0:f.absolute)||"",((N=(p=r.comparison)==null?void 0:p.differences)==null?void 0:N.relative)||"",((k=(P=r.comparison)==null?void 0:P.agreement)==null?void 0:k.level)||"",(($=(L=r.comparison)==null?void 0:L.agreement)==null?void 0:$.higherRiskModel)||""].join(",")});return[t.join(","),...i].join(`
`)}static exportAsJSON(){const e=this.getStoredData();return JSON.stringify(e,null,2)}static downloadData(e="csv"){try{const t=e==="csv"?this.exportAsCSV():this.exportAsJSON(),i=`igfap-research-${Date.now()}.${e}`,s=new Blob([t],{type:e==="csv"?"text/csv":"application/json"}),r=URL.createObjectURL(s),n=document.createElement("a");return n.href=r,n.download=i,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),!0}catch(t){return!1}}static clearData(){try{return localStorage.removeItem(this.STORAGE_KEY),!0}catch(e){return!1}}static getDataSummary(){var r,n;const e=this.getStoredData();if(!e.entries||e.entries.length===0)return{totalEntries:0,dateRange:null,avgDifference:null};const{entries:t}=e,i=t.map(a=>{var c,u;return(u=(c=a.comparison)==null?void 0:c.differences)==null?void 0:u.absolute}).filter(a=>a!=null),s=i.length>0?i.reduce((a,c)=>a+Math.abs(c),0)/i.length:0;return{totalEntries:t.length,dateRange:{first:(r=t[0])==null?void 0:r.timestamp,last:(n=t[t.length-1])==null?void 0:n.timestamp},avgAbsoluteDifference:Math.round(s*10)/10,storageSize:JSON.stringify(e).length}}static generateEntryId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static getSessionId(){let e=sessionStorage.getItem("research_session_id");return e||(e=`session_${Date.now().toString(36)}`,sessionStorage.setItem("research_session_id",e)),e}}C(R,"STORAGE_KEY","igfap_research_data"),C(R,"MAX_ENTRIES",1e3);function ae(o,e,t){try{if(!Y())return;const i={inputs:{age:t.age_years||t.age,gfap:t.gfap_value||t.gfap,module:o.module||"unknown"},main:{probability:o.probability,module:o.module,confidence:o.confidence},legacy:e,comparison:e?S.compareModels(o,e):null};R.logComparison(i)}catch(i){}}function Y(o=null){var e;if(o==="coma")return!1;if(o==="limited"||o==="full")return!0;if(typeof window!="undefined")try{const t=window.store||((e=require("../state/store.js"))==null?void 0:e.store);if(t){const{formData:i}=t.getState();return i.limited||i.full}}catch(t){}return!1}function oe(){return""}function ce(o,e,t){if(!(e!=null&&e.isValid))return`
      <div class="research-panel" id="researchPanel" style="display: none;">
        <div class="research-header">
          <h4>üî¨ Model Comparison (Research)</h4>
          <button class="close-research" id="closeResearch">√ó</button>
        </div>
        <div class="research-error">
          <p>‚ö†Ô∏è Legacy model calculation failed</p>
          <small>Debug: ${(e==null?void 0:e.reason)||"Unknown error"}</small>
        </div>
      </div>
    `;const i=S.compareModels(o,e);return`
    <div class="research-panel" id="researchPanel" style="display: none;">
      <div class="research-header">
        <h4>üî¨ Model Comparison (Research)</h4>
        <button class="close-research" id="closeResearch">√ó</button>
      </div>
      
      <div class="model-comparison">
        ${j(o,e)}
        ${V(i)}
        ${B(e,t)}
        ${Q()}
      </div>
      
      <div class="research-actions">
        <button id="exportResearchData" class="research-btn">üì• Export Data</button>
        <button id="toggleCalculationDetails" class="research-btn">üßÆ Details</button>
        <button id="clearResearchData" class="research-btn danger">üóëÔ∏è Clear</button>
      </div>
      
      <div class="research-disclaimer">
        <small>
          ‚ö†Ô∏è <strong>Research Mode Active</strong><br>
          Legacy model: Age + GFAP only (ROC-AUC: 0.789, Recall: 40%)<br>
          For baseline comparison. Main model includes additional clinical factors.
        </small>
      </div>
    </div>
  `}function j(o,e){let t=o.probability||0;t<=1&&(t*=100);const i=e.probability||0;return`
    <div class="probability-comparison">
      <div class="bar-group">
        <label class="bar-label">Main Model (Complex) - ${o.module||"Unknown"}</label>
        <div class="probability-bar">
          <div class="bar-fill main-model" style="width: ${Math.max(10,Math.min(t,100))}%">
            <span class="bar-value">${t.toFixed(1)}%</span>
          </div>
        </div>
      </div>

      <div class="bar-group">
        <label class="bar-label">Legacy Model (Age + GFAP Only)</label>
        <div class="probability-bar">
          <div class="bar-fill legacy-model" style="width: ${Math.max(10,Math.min(i,100))}%">
            <span class="bar-value">${i.toFixed(1)}%</span>
          </div>
        </div>
      </div>
    </div>
  `}function V(o){if(!o.isValid)return'<div class="comparison-error">Unable to compare models</div>';const{differences:e,agreement:t}=o;return`
    <div class="difference-analysis">
      <div class="difference-metric">
        <span class="metric-label">Difference:</span>
        <span class="metric-value ${e.absolute>0?"higher":"lower"}">
          ${e.absolute>0?"+":""}${e.absolute}%
        </span>
      </div>
      
      <div class="agreement-level">
        <span class="metric-label">Agreement:</span>
        <span class="agreement-badge ${t.level}">
          ${t.level.charAt(0).toUpperCase()+t.level.slice(1)}
        </span>
      </div>
      
      <div class="interpretation">
        <p class="interpretation-text">${o.interpretation.message}</p>
        <small class="interpretation-detail">${o.interpretation.implication}</small>
      </div>
    </div>
  `}function B(o,e){return`
    <div class="calculation-details" id="calculationDetails" style="display: none;">
      <h5>Legacy Model Calculation</h5>
      <div class="calculation-steps">
        <div class="step">
          <strong>Inputs:</strong> Age ${e.age}, GFAP ${e.gfap} pg/ml
        </div>
        <div class="step">
          <strong>Scaling:</strong> Age ‚Üí ${o.scaledInputs.age}, GFAP ‚Üí ${o.scaledInputs.gfap}
        </div>
        <div class="step">
          <strong>Logit:</strong> ${o.logit}
        </div>
        <div class="step">
          <strong>Probability:</strong> ${o.probability}% (Confidence: ${(o.confidence*100).toFixed(0)}%)
        </div>
      </div>
    </div>
  `}function Q(){const o=S.getModelMetadata();return`
    <div class="model-metrics">
      <h5>Performance Comparison</h5>
      <div class="metrics-grid">
        <div class="metric-item">
          <span class="metric-name">ROC-AUC</span>
          <span class="metric-value">Legacy: ${o.performance.rocAuc}</span>
        </div>
        <div class="metric-item">
          <span class="metric-name">Recall</span>
          <span class="metric-value">Legacy: ${(o.performance.recall*100).toFixed(0)}%</span>
        </div>
        <div class="metric-item">
          <span class="metric-name">Precision</span>
          <span class="metric-value">Legacy: ${(o.performance.precision*100).toFixed(0)}%</span>
        </div>
      </div>
    </div>
  `}function le(){if(!document.getElementById("researchPanel"))return;const e=document.getElementById("closeResearch");e&&e.addEventListener("click",()=>{const r=document.getElementById("researchPanel");r&&(r.style.display="none")});const t=document.getElementById("exportResearchData");t&&t.addEventListener("click",()=>{R.downloadData("csv")});const i=document.getElementById("toggleCalculationDetails");i&&i.addEventListener("click",()=>{const r=document.getElementById("calculationDetails");r&&(r.style.display=r.style.display==="none"?"block":"none",i.textContent=r.style.display==="none"?"üßÆ Details":"üßÆ Hide")});const s=document.getElementById("clearResearchData");s&&s.addEventListener("click",()=>{confirm("Clear all research data? This cannot be undone.")&&(R.clearData(),R.getDataSummary())})}const I={CLINICAL_SUMMARY:"clinical_summary",OUTCOME_PREDICTION:"outcome_prediction",RISK_ASSESSMENT:"risk_assessment",DECISION_SUPPORT:"decision_support",QUALITY_METRICS:"quality_metrics",RESEARCH_ANALYTICS:"research_analytics",COMPREHENSIVE:"comprehensive"},A={PDF:"pdf",HTML:"html",JSON:"json",CSV:"csv",DICOM_SR:"dicom_sr"},b={DOWNLOAD:"download",EMAIL:"email",EHR_INTEGRATION:"ehr_integration",PACS:"pacs",API:"api"};class z{constructor(){this.templates=new Map,this.reportHistory=[],this.scheduledReports=new Map,this.isInitialized=!1,this.initializeTemplates()}initializeTemplates(){this.templates.set(I.CLINICAL_SUMMARY,{name:"Clinical Summary Report",sections:["patient_demographics","clinical_presentation","assessment_findings","risk_stratification","treatment_recommendations","disposition"],requiredData:["patientData","predictions"],format:"structured"}),this.templates.set(I.OUTCOME_PREDICTION,{name:"Outcome Prediction Report",sections:["prediction_overview","mortality_risk","functional_outcome","complications_risk","model_performance","confidence_metrics"],requiredData:["predictions","mlResults"],format:"analytical"}),this.templates.set(I.RISK_ASSESSMENT,{name:"Risk Assessment Report",sections:["risk_profile","hemorrhagic_risk","procedural_risks","contraindications","monitoring_requirements","escalation_criteria"],requiredData:["patientData","predictions","alerts"],format:"clinical"}),this.templates.set(I.DECISION_SUPPORT,{name:"Clinical Decision Support Report",sections:["treatment_options","evidence_summary","guideline_recommendations","clinical_alerts","action_plan","follow_up"],requiredData:["patientData","predictions","recommendations"],format:"actionable"}),this.templates.set(I.QUALITY_METRICS,{name:"Quality Metrics Report",sections:["performance_indicators","process_metrics","outcome_measures","benchmarking","improvement_opportunities","action_items"],requiredData:["qualityMetrics","benchmarks"],format:"dashboard"}),this.templates.set(I.COMPREHENSIVE,{name:"Comprehensive Clinical Report",sections:["executive_summary","clinical_summary","risk_assessment","outcome_predictions","decision_support","quality_metrics","research_insights","appendices"],requiredData:["all"],format:"comprehensive"})}async generateReport(e,t,i={}){var r;const s=v.startMeasurement(O.REPORT_GENERATION,`generate_${e}_report`);try{const n=this.templates.get(e);if(!n)throw new Error(`Unknown report type: ${e}`);this.validateReportData(n,t);const a=await this.buildReportContent(n,t,i),c=await this.formatReport(a,i.format||A.HTML),u={id:`report_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:e,format:i.format||A.HTML,generated:new Date().toISOString(),generator:"ClinicalReportGenerator",version:"1.0",patient:((r=t.patientData)==null?void 0:r.id)||"unknown",size:c.length};return this.reportHistory.push({...u,dataSnapshot:this.createDataSnapshot(t)}),v.endMeasurement(s,{success:!0}),g.publish(h.AUDIT_EVENT,{action:"clinical_report_generated",reportType:e,reportId:u.id,patient:u.patient}),{metadata:u,content:c,sections:a.sections,dataQuality:a.dataQuality}}catch(n){throw v.endMeasurement(s,{success:!1,error:n.message}),n}}validateReportData(e,t){const i=[];for(const s of e.requiredData)s!=="all"&&(t[s]||i.push(s));if(i.length>0)throw new Error(`Missing required data: ${i.join(", ")}`)}async buildReportContent(e,t,i){const s={},r={score:100,issues:[]};for(const n of e.sections)try{const a=await this.generateSection(n,t,i);s[n]=a,a.quality&&a.quality.score<r.score&&(r.score=a.quality.score,r.issues=r.issues.concat(a.quality.issues||[]))}catch(a){s[n]={title:this.getSectionTitle(n),content:`Error generating section: ${a.message}`,error:!0},r.issues.push(`Section ${n} generation failed`)}return{template:e.name,sections:s,dataQuality:r,generated:new Date().toISOString()}}async generateSection(e,t,i){var s,r,n,a,c;switch(e){case"patient_demographics":return this.generatePatientDemographics(t.patientData);case"clinical_presentation":return this.generateClinicalPresentation(t.patientData);case"assessment_findings":return this.generateAssessmentFindings(t.patientData,t.predictions);case"risk_stratification":return this.generateRiskStratification(t.predictions);case"treatment_recommendations":return this.generateTreatmentRecommendations(t.recommendations||((s=t.predictions)==null?void 0:s.recommendations));case"disposition":return this.generateDisposition(t.predictions);case"prediction_overview":return this.generatePredictionOverview(t.predictions);case"mortality_risk":return this.generateMortalityRisk((r=t.predictions)==null?void 0:r.mortality);case"functional_outcome":return this.generateFunctionalOutcome((n=t.predictions)==null?void 0:n.functionalOutcome);case"complications_risk":return this.generateComplicationsRisk((a=t.predictions)==null?void 0:a.complications);case"model_performance":return this.generateModelPerformance(t.mlResults);case"confidence_metrics":return this.generateConfidenceMetrics(t.predictions);case"risk_profile":return this.generateRiskProfile(t.patientData,t.predictions);case"hemorrhagic_risk":return this.generateHemorrhagicRisk((c=t.predictions)==null?void 0:c.hemorrhagicRisk);case"procedural_risks":return this.generateProceduralRisks(t.patientData);case"contraindications":return this.generateContraindications(t.patientData);case"monitoring_requirements":return this.generateMonitoringRequirements(t.predictions);case"escalation_criteria":return this.generateEscalationCriteria(t.predictions);case"treatment_options":return this.generateTreatmentOptions(t.patientData,t.predictions);case"evidence_summary":return this.generateEvidenceSummary(t.patientData);case"guideline_recommendations":return this.generateGuidelineRecommendations(t.patientData);case"clinical_alerts":return this.generateClinicalAlerts(t.alerts);case"action_plan":return this.generateActionPlan(t.recommendations);case"follow_up":return this.generateFollowUp(t.predictions);case"executive_summary":return this.generateExecutiveSummary(t);case"research_insights":return this.generateResearchInsights(t);case"appendices":return this.generateAppendices(t);default:throw new Error(`Unknown section: ${e}`)}}generatePatientDemographics(e){const t=[];return e.age&&t.push(`Age: ${e.age} years`),e.gender&&t.push(`Gender: ${e.gender}`),e.weight&&t.push(`Weight: ${e.weight} kg`),e.medical_history&&t.push(`Medical History: ${e.medical_history}`),{title:"Patient Demographics",content:t.join("; "),quality:this.assessDataQuality(["age","gender"],e)}}generateClinicalPresentation(e){const t=[];return e.symptom_onset&&t.push(`Symptom onset: ${e.symptom_onset} hours ago`),e.gcs_score&&t.push(`Glasgow Coma Scale: ${e.gcs_score}/15`),e.systolic_bp&&e.diastolic_bp&&t.push(`Blood Pressure: ${e.systolic_bp}/${e.diastolic_bp} mmHg`),e.fast_ed_score&&t.push(`FAST-ED Score: ${e.fast_ed_score}/10`),{title:"Clinical Presentation",content:t.join("<br>"),quality:this.assessDataQuality(["symptom_onset","gcs_score","systolic_bp"],e)}}generateAssessmentFindings(e,t){const i=[];if(e.gfap_value){const s=parseFloat(e.gfap_value);i.push(`GFAP Biomarker: ${s.toLocaleString()} pg/mL${s>5e3?" (Elevated)":""}`)}return e.ich_volume&&i.push(`ICH Volume: ${e.ich_volume} mL`),t!=null&&t.lvoDetection&&i.push(`LVO Detection: ${t.lvoDetection.probability}% probability`),{title:"Assessment Findings",content:i.join("<br>"),quality:this.assessDataQuality(["gfap_value"],e)}}generateRiskStratification(e){var i,s,r;const t=[];if(e!=null&&e.mortality){const{risk:n}=e.mortality,a=((i=e.mortality.riskLevel)==null?void 0:i.level)||"unknown";t.push(`<strong>Mortality Risk:</strong> ${n}% (${a})`)}if(e!=null&&e.hemorrhagicRisk){const{risk:n}=e.hemorrhagicRisk,a=((s=e.hemorrhagicRisk.riskLevel)==null?void 0:s.level)||"unknown";t.push(`<strong>Hemorrhagic Risk:</strong> ${n}% (${a})`)}if(e!=null&&e.compositeRisk){const{score:n}=e.compositeRisk,a=((r=e.compositeRisk.riskLevel)==null?void 0:r.level)||"unknown";t.push(`<strong>Composite Risk:</strong> ${n}% (${a})`)}return{title:"Risk Stratification",content:t.join("<br>"),quality:{score:e?95:0,issues:e?[]:["No predictions available"]}}}generateTreatmentRecommendations(e){if(!e)return{title:"Treatment Recommendations",content:"No recommendations available",quality:{score:0,issues:["No recommendations data"]}};const t=[];return e.priority&&e.priority.length>0&&(t.push("<strong>Priority Actions:</strong>"),e.priority.forEach(i=>{t.push(`‚Ä¢ ${i.action} (${i.rationale})`)})),e.standard&&e.standard.length>0&&(t.push("<br><strong>Standard Care:</strong>"),e.standard.forEach(i=>{t.push(`‚Ä¢ ${i.action} (${i.rationale})`)})),{title:"Treatment Recommendations",content:t.join("<br>"),quality:{score:90,issues:[]}}}generateDisposition(e){var i,s,r;let t="Standard stroke unit care";return((i=e==null?void 0:e.mortality)==null?void 0:i.risk)>50?t="ICU admission recommended due to high mortality risk":((s=e==null?void 0:e.hemorrhagicRisk)==null?void 0:s.risk)>40?t="Enhanced monitoring unit due to hemorrhagic transformation risk":((r=e==null?void 0:e.compositeRisk)==null?void 0:r.score)>60&&(t="Stroke unit with close monitoring"),{title:"Disposition",content:t,quality:{score:e?85:0,issues:e?[]:["No predictions for disposition"]}}}generatePredictionOverview(e){var i,s;if(!e)return{title:"Prediction Overview",content:"No predictions available",quality:{score:0,issues:["No predictions data"]}};const t=['<table class="prediction-table">',"<tr><th>Outcome</th><th>Prediction</th><th>Confidence</th></tr>"];return e.mortality&&t.push(`<tr><td>30-Day Mortality</td><td>${e.mortality.risk}%</td><td>${((i=e.mortality.confidence)==null?void 0:i.level)||"N/A"}</td></tr>`),e.functionalOutcome&&t.push(`<tr><td>Good Functional Outcome</td><td>${e.functionalOutcome.probability}%</td><td>${((s=e.functionalOutcome.confidence)==null?void 0:s.level)||"N/A"}</td></tr>`),e.hemorrhagicRisk&&t.push(`<tr><td>Hemorrhagic Transformation</td><td>${e.hemorrhagicRisk.risk}%</td><td>High</td></tr>`),t.push("</table>"),{title:"Prediction Overview",content:t.join(""),quality:{score:95,issues:[]}}}generateMortalityRisk(e){var i,s,r;if(!e)return{title:"Mortality Risk",content:"Mortality risk assessment not available",quality:{score:0,issues:["No mortality data"]}};const t=[`<p><strong>30-Day Mortality Risk:</strong> ${e.risk}%</p>`,`<p><strong>Risk Level:</strong> ${((i=e.riskLevel)==null?void 0:i.label)||"Unknown"}</p>`,`<p><strong>Confidence:</strong> ${((s=e.confidence)==null?void 0:s.level)||"Unknown"} (${((r=e.confidence)==null?void 0:r.percent)||0}%)</p>`];return e.explanation&&t.push(`<p><strong>Explanation:</strong> ${e.explanation}</p>`),e.factors&&e.factors.length>0&&(t.push("<p><strong>Contributing Factors:</strong></p>"),t.push("<ul>"),e.factors.forEach(n=>{t.push(`<li>${n.name}: ${n.impact} impact (weight: ${Math.round((n.weight||0)*100)}%)</li>`)}),t.push("</ul>")),{title:"Mortality Risk Analysis",content:t.join(""),quality:{score:95,issues:[]}}}generateFunctionalOutcome(e){var i;if(!e)return{title:"Functional Outcome",content:"Functional outcome prediction not available",quality:{score:0,issues:["No functional outcome data"]}};const t=[`<p><strong>Probability of Good Outcome (mRS 0-2):</strong> ${e.probability}%</p>`,`<p><strong>Predicted Outcome:</strong> ${e.outcome}</p>`,`<p><strong>Confidence:</strong> ${((i=e.confidence)==null?void 0:i.level)||"Unknown"}</p>`];return e.factors&&e.factors.length>0&&(t.push("<p><strong>Influencing Factors:</strong></p>"),t.push("<ul>"),e.factors.forEach(s=>{t.push(`<li>${s.name}: ${s.impact} impact - ${s.description}</li>`)}),t.push("</ul>")),{title:"Functional Outcome Prediction",content:t.join(""),quality:{score:90,issues:[]}}}generateExecutiveSummary(e){var i,s,r,n,a,c;const t=[];if((i=e.patientData)!=null&&i.age&&t.push(`${e.patientData.age}-year-old patient presenting with stroke symptoms.`),(s=e.patientData)!=null&&s.gfap_value){const u=parseFloat(e.patientData.gfap_value);t.push(`GFAP level: ${u.toLocaleString()} pg/mL${u>5e3?" (significantly elevated)":""}.`)}if((r=e.predictions)!=null&&r.compositeRisk){const u=e.predictions.compositeRisk.score,E=((n=e.predictions.compositeRisk.riskLevel)==null?void 0:n.level)||"unknown";t.push(`Overall risk assessment: ${u}% (${E} risk).`)}return(c=(a=e.predictions)==null?void 0:a.recommendations)!=null&&c.summary&&t.push(e.predictions.recommendations.summary),{title:"Executive Summary",content:t.join(" "),quality:{score:85,issues:[]}}}assessDataQuality(e,t){const i=e.filter(n=>t[n]!==void 0&&t[n]!==null&&t[n]!==""),s=i.length/e.length*100,r=e.filter(n=>!i.includes(n));return{score:Math.round(s),issues:r.length>0?[`Missing data: ${r.join(", ")}`]:[]}}getSectionTitle(e){return{patient_demographics:"Patient Demographics",clinical_presentation:"Clinical Presentation",assessment_findings:"Assessment Findings",risk_stratification:"Risk Stratification",treatment_recommendations:"Treatment Recommendations",disposition:"Disposition",prediction_overview:"Prediction Overview",mortality_risk:"Mortality Risk",functional_outcome:"Functional Outcome",complications_risk:"Complications Risk",model_performance:"Model Performance",confidence_metrics:"Confidence Metrics",executive_summary:"Executive Summary"}[e]||e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}async formatReport(e,t){switch(t){case A.HTML:return this.formatAsHTML(e);case A.PDF:return this.formatAsPDF(e);case A.JSON:return JSON.stringify(e,null,2);case A.CSV:return this.formatAsCSV(e);default:return this.formatAsHTML(e)}}formatAsHTML(e){const t=["<!DOCTYPE html>",'<html lang="en">',"<head>",'<meta charset="UTF-8">','<meta name="viewport" content="width=device-width, initial-scale=1.0">',`<title>${e.template}</title>`,"<style>",this.getReportCSS(),"</style>","</head>","<body>",'<div class="report-container">','<header class="report-header">',`<h1>${e.template}</h1>`,`<div class="report-meta">Generated: ${e.generated}</div>`,`<div class="data-quality">Data Quality: ${e.dataQuality.score}%</div>`,"</header>",'<main class="report-content">'];return Object.entries(e.sections).forEach(([i,s])=>{t.push(`<section class="report-section" id="${i}">`),t.push(`<h2>${s.title}</h2>`),t.push(`<div class="section-content">${s.content}</div>`),s.quality&&s.quality.score<100&&t.push(`<div class="quality-indicator">Quality: ${s.quality.score}%</div>`),t.push("</section>")}),t.push("</main>"),t.push("</div>"),t.push("</body>"),t.push("</html>"),t.join(`
`)}getReportCSS(){return`
      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }

      .report-container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
      }

      .report-header {
        background: #2196F3;
        color: white;
        padding: 30px;
        text-align: center;
      }

      .report-header h1 {
        margin: 0 0 10px 0;
        font-size: 2.5em;
      }

      .report-meta {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .data-quality {
        margin-top: 10px;
        padding: 5px 15px;
        background: rgba(255,255,255,0.2);
        border-radius: 20px;
        display: inline-block;
      }

      .report-content {
        padding: 40px;
      }

      .report-section {
        margin-bottom: 40px;
        border-bottom: 1px solid #e0e0e0;
        padding-bottom: 30px;
      }

      .report-section:last-child {
        border-bottom: none;
      }

      .report-section h2 {
        color: #2196F3;
        margin: 0 0 20px 0;
        font-size: 1.8em;
        border-left: 4px solid #2196F3;
        padding-left: 15px;
      }

      .section-content {
        font-size: 1.1em;
        line-height: 1.8;
      }

      .quality-indicator {
        margin-top: 10px;
        font-size: 0.8em;
        color: #666;
        text-align: right;
      }

      .prediction-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .prediction-table th,
      .prediction-table td {
        border: 1px solid #ddd;
        padding: 12px;
        text-align: left;
      }

      .prediction-table th {
        background: #f5f5f5;
        font-weight: bold;
      }

      .prediction-table tr:nth-child(even) {
        background: #f9f9f9;
      }

      ul {
        margin: 15px 0;
      }

      li {
        margin: 5px 0;
      }

      p {
        margin: 15px 0;
      }

      strong {
        color: #333;
      }

      @media print {
        body {
          background: white;
          padding: 0;
        }

        .report-container {
          box-shadow: none;
          border-radius: 0;
        }

        .report-section {
          page-break-inside: avoid;
        }
      }
    `}createDataSnapshot(e){return{hasPatientData:!!e.patientData,hasPredictions:!!e.predictions,hasMLResults:!!e.mlResults,hasRecommendations:!!e.recommendations,timestamp:new Date().toISOString()}}generateClinicalAlerts(e){return!e||e.length===0?{title:"Clinical Alerts",content:"No active alerts",quality:{score:100,issues:[]}}:{title:"Clinical Alerts",content:e.map(i=>{var s;return`<div class="alert ${(s=i.severity)==null?void 0:s.level}">
        <strong>${i.title}</strong><br>
        ${i.message}<br>
        <em>Recommendation: ${i.recommendation}</em>
      </div>`}).join(""),quality:{score:95,issues:[]}}}generateHemorrhagicRisk(e){var i;if(!e)return{title:"Hemorrhagic Risk",content:"Hemorrhagic risk assessment not available",quality:{score:0,issues:["No hemorrhagic risk data"]}};const t=[`<p><strong>Hemorrhagic Transformation Risk:</strong> ${e.risk}%</p>`,`<p><strong>Risk Level:</strong> ${((i=e.riskLevel)==null?void 0:i.label)||"Unknown"}</p>`,`<p><strong>Recommendation:</strong> ${e.recommendation}</p>`];return e.activeFactors&&e.activeFactors.length>0&&(t.push("<p><strong>Active Risk Factors:</strong></p>"),t.push("<ul>"),e.activeFactors.forEach(s=>{t.push(`<li>${s.factor}: ${s.contribution}% contribution</li>`)}),t.push("</ul>")),{title:"Hemorrhagic Transformation Risk",content:t.join(""),quality:{score:90,issues:[]}}}generateResearchInsights(e){return{title:"Research Insights",content:"Research analytics and population-based insights would be generated here based on anonymized data comparisons.",quality:{score:70,issues:["Research module not fully implemented"]}}}generateAppendices(e){return{title:"Appendices",content:"Technical details, model specifications, and additional data would be included in appendices.",quality:{score:80,issues:[]}}}generateModelPerformance(e){return{title:"Model Performance",content:e?"Model performance metrics and validation results.":"No ML results available.",quality:{score:e?85:0,issues:e?[]:["No ML results"]}}}generateConfidenceMetrics(e){return{title:"Confidence Metrics",content:e?"Prediction confidence analysis and reliability metrics.":"No predictions available.",quality:{score:e?90:0,issues:e?[]:["No predictions"]}}}generateRiskProfile(e,t){return{title:"Risk Profile",content:"Comprehensive risk profile based on clinical and predictive factors.",quality:{score:85,issues:[]}}}generateProceduralRisks(e){return{title:"Procedural Risks",content:"Assessment of risks associated with potential interventions.",quality:{score:80,issues:[]}}}generateContraindications(e){return{title:"Contraindications",content:"Analysis of contraindications for various treatment options.",quality:{score:85,issues:[]}}}generateMonitoringRequirements(e){return{title:"Monitoring Requirements",content:"Recommended monitoring protocols based on risk assessment.",quality:{score:90,issues:[]}}}generateEscalationCriteria(e){return{title:"Escalation Criteria",content:"Criteria for escalating care based on clinical deterioration.",quality:{score:85,issues:[]}}}generateTreatmentOptions(e,t){return{title:"Treatment Options",content:"Available treatment options with risk-benefit analysis.",quality:{score:88,issues:[]}}}generateEvidenceSummary(e){return{title:"Evidence Summary",content:"Summary of relevant clinical evidence and guidelines.",quality:{score:75,issues:[]}}}generateGuidelineRecommendations(e){return{title:"Guideline Recommendations",content:"Relevant clinical guideline recommendations.",quality:{score:85,issues:[]}}}generateActionPlan(e){return{title:"Action Plan",content:e?"Structured action plan based on recommendations.":"No recommendations available.",quality:{score:e?90:0,issues:e?[]:["No recommendations"]}}}generateFollowUp(e){return{title:"Follow-up",content:"Recommended follow-up schedule and monitoring plan.",quality:{score:85,issues:[]}}}generateComplicationsRisk(e){if(!e)return{title:"Complications Risk",content:"Complications risk assessment not available",quality:{score:0,issues:["No complications data"]}};const t=[`<p><strong>Overall Complications Risk:</strong> ${e.totalRisk}%</p>`];return e.complications&&e.complications.length>0&&(t.push("<p><strong>Specific Complications:</strong></p>"),t.push("<ul>"),e.complications.forEach(i=>{t.push(`<li>${i.type}: ${i.risk}% risk</li>`)}),t.push("</ul>")),{title:"Complications Risk Assessment",content:t.join(""),quality:{score:90,issues:[]}}}}class x{constructor(){this.reportGenerator=new z,this.scheduledReports=new Map,this.deliveryQueue=[],this.isActive=!1}start(){this.isActive=!0,this.processDeliveryQueue(),g.publish(h.AUDIT_EVENT,{action:"clinical_reporting_system_started"})}async generateComprehensiveReport(e,t={}){return await this.reportGenerator.generateReport(I.COMPREHENSIVE,e,t)}async generateReport(e,t,i={}){return await this.reportGenerator.generateReport(e,t,i)}scheduleReport(e){const t=`schedule_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;return this.scheduledReports.set(t,{...e,id:t,created:new Date().toISOString(),lastGenerated:null,nextGeneration:this.calculateNextGeneration(e.frequency)}),g.publish(h.AUDIT_EVENT,{action:"report_scheduled",scheduleId:t,reportType:e.reportType}),t}queueReportForDelivery(e,t,i={}){this.deliveryQueue.push({report:e,deliveryMethod:t,deliveryOptions:i,queued:new Date().toISOString(),attempts:0,maxAttempts:3}),this.isActive&&this.processDeliveryQueue()}async processDeliveryQueue(){for(;this.deliveryQueue.length>0&&this.isActive;){const e=this.deliveryQueue.shift();try{await this.deliverReport(e)}catch(t){e.attempts++,e.attempts<e.maxAttempts&&setTimeout(()=>{this.deliveryQueue.push(e)},6e4*e.attempts)}}this.isActive&&setTimeout(()=>this.processDeliveryQueue(),3e4)}async deliverReport(e){const{report:t,deliveryMethod:i,deliveryOptions:s}=e;switch(i){case b.DOWNLOAD:this.triggerDownload(t);break;case b.EMAIL:await this.emailReport(t,s);break;case b.EHR_INTEGRATION:await this.integrateWithEHR(t,s);break;case b.API:await this.sendToAPI(t,s);break;default:throw new Error(`Unknown delivery method: ${i}`)}g.publish(h.AUDIT_EVENT,{action:"report_delivered",reportId:t.metadata.id,deliveryMethod:i})}triggerDownload(e){const t=new Blob([e.content],{type:"text/html"}),i=URL.createObjectURL(t),s=document.createElement("a");s.href=i,s.download=`clinical-report-${e.metadata.id}.html`,s.click(),URL.revokeObjectURL(i)}async emailReport(e,t){}async integrateWithEHR(e,t){}async sendToAPI(e,t){}calculateNextGeneration(e){const t=new Date;switch(e){case"daily":return new Date(t.getTime()+24*60*60*1e3).toISOString();case"weekly":return new Date(t.getTime()+7*24*60*60*1e3).toISOString();case"monthly":return new Date(t.getTime()+30*24*60*60*1e3).toISOString();default:return null}}getReportHistory(e={}){return this.reportGenerator.reportHistory.filter(t=>!(e.reportType&&t.type!==e.reportType||e.startDate&&new Date(t.generated)<new Date(e.startDate)||e.endDate&&new Date(t.generated)>new Date(e.endDate)))}getReportingStatistics(){const e=this.reportGenerator.reportHistory;return{totalReports:e.length,reportsByType:this.groupBy(e,"type"),averageDataQuality:this.calculateAverageDataQuality(e),reportingTrends:this.calculateReportingTrends(e),scheduledReports:this.scheduledReports.size,queuedDeliveries:this.deliveryQueue.length}}groupBy(e,t){return e.reduce((i,s)=>{const r=s[t]||"unknown";return i[r]=(i[r]||0)+1,i},{})}calculateAverageDataQuality(e){if(e.length===0)return 0;const t=e.reduce((i,s)=>{var r;return i+(((r=s.dataSnapshot)==null?void 0:r.quality)||85)},0);return Math.round(t/e.length)}calculateReportingTrends(e){const t=e.filter(i=>new Date(i.generated)>new Date(Date.now()-2592e6));return{reportsLast30Days:t.length,averageReportsPerDay:Math.round(t.length/30*10)/10}}stop(){this.isActive=!1,g.publish(h.AUDIT_EVENT,{action:"clinical_reporting_system_stopped"})}}const X=new x,de=Object.freeze(Object.defineProperty({__proto__:null,ClinicalReportingSystem:x,DeliveryMethods:b,ReportFormats:A,ReportTypes:I,clinicalReportingSystem:X},Symbol.toStringTag,{value:"Module"})),m={PROCESS:"process",OUTCOME:"outcome",STRUCTURE:"structure",SAFETY:"safety",EFFICIENCY:"efficiency",PATIENT_EXPERIENCE:"patient_experience"},l={DOOR_TO_NEEDLE_TIME:"door_to_needle_time",DOOR_TO_IMAGING_TIME:"door_to_imaging_time",IMAGING_TO_DECISION_TIME:"imaging_to_decision_time",MORTALITY_RATE_30D:"mortality_rate_30d",FUNCTIONAL_INDEPENDENCE_90D:"functional_independence_90d",HEMORRHAGIC_TRANSFORMATION_RATE:"hemorrhagic_transformation_rate",THROMBOLYSIS_RATE:"thrombolysis_rate",MECHANICAL_THROMBECTOMY_RATE:"mechanical_thrombectomy_rate",PREDICTION_ACCURACY:"prediction_accuracy",MODEL_CALIBRATION:"model_calibration",ALERT_APPROPRIATENESS:"alert_appropriateness",GUIDELINE_ADHERENCE:"guideline_adherence"},M={[l.DOOR_TO_NEEDLE_TIME]:{target:60,excellent:45,good:60,acceptable:90,unit:"minutes"},[l.DOOR_TO_IMAGING_TIME]:{target:25,excellent:20,good:25,acceptable:45,unit:"minutes"},[l.MORTALITY_RATE_30D]:{target:15,excellent:10,good:15,acceptable:20,unit:"percentage"},[l.FUNCTIONAL_INDEPENDENCE_90D]:{target:50,excellent:60,good:50,acceptable:40,unit:"percentage"},[l.THROMBOLYSIS_RATE]:{target:15,excellent:20,good:15,acceptable:10,unit:"percentage"},[l.PREDICTION_ACCURACY]:{target:85,excellent:90,good:85,acceptable:80,unit:"percentage"}};class w{constructor(e,t,i,s,r={}){this.indicator=e,this.category=t,this.value=i,this.timestamp=s,this.metadata=r,this.benchmark=M[e],this.performance=this.calculatePerformance()}calculatePerformance(){if(!this.benchmark)return{level:"unknown",score:null};const{excellent:e,good:t,acceptable:i}=this.benchmark,s=this.indicator.includes("time")||this.indicator.includes("mortality");let r,n;return s?this.value<=e?(r="excellent",n=100):this.value<=t?(r="good",n=85):this.value<=i?(r="acceptable",n=70):(r="needs_improvement",n=Math.max(0,50-(this.value-i)/i*25)):this.value>=e?(r="excellent",n=100):this.value>=t?(r="good",n=85):this.value>=i?(r="acceptable",n=70):(r="needs_improvement",n=Math.max(0,this.value/i*70)),{level:r,score:Math.round(n)}}getStatus(){return{indicator:this.indicator,value:this.value,benchmark:this.benchmark,performance:this.performance,timestamp:this.timestamp}}}class J{constructor(){this.metrics=[],this.aggregations=new Map,this.trends=new Map}addMetric(e){this.metrics.push(e),this.updateAggregations(e),this.updateTrends(e)}updateAggregations(e){const t=e.indicator;this.aggregations.has(t)||this.aggregations.set(t,{count:0,sum:0,min:1/0,max:-1/0,values:[]});const i=this.aggregations.get(t);i.count++,i.sum+=e.value,i.min=Math.min(i.min,e.value),i.max=Math.max(i.max,e.value),i.values.push({value:e.value,timestamp:e.timestamp}),i.values.length>100&&i.values.shift()}updateTrends(e){const t=e.indicator,i=new Date,s=`${i.getFullYear()}-${i.getMonth()+1}-${i.getDate()}`;this.trends.has(t)||this.trends.set(t,new Map);const r=this.trends.get(t);r.has(s)||r.set(s,{date:s,values:[],average:0,count:0});const n=r.get(s);n.values.push(e.value),n.count++,n.average=n.values.reduce((a,c)=>a+c,0)/n.count}getAggregatedStats(e){const t=this.aggregations.get(e);return t?{indicator:e,count:t.count,average:t.sum/t.count,min:t.min,max:t.max,median:this.calculateMedian(t.values.map(i=>i.value)),standardDeviation:this.calculateStandardDeviation(t.values.map(i=>i.value))}:null}getTrendData(e,t=30){const i=this.trends.get(e);if(!i)return null;const s=new Date,r=[];for(let n=t-1;n>=0;n--){const a=new Date(s.getTime()-n*24*60*60*1e3),c=`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`;i.has(c)?r.push(i.get(c)):r.push({date:c,values:[],average:null,count:0})}return r}calculateMedian(e){const t=[...e].sort((s,r)=>s-r),i=Math.floor(t.length/2);return t.length%2!==0?t[i]:(t[i-1]+t[i])/2}calculateStandardDeviation(e){const t=e.reduce((r,n)=>r+n,0)/e.length,s=e.map(r=>(r-t)**2).reduce((r,n)=>r+n,0)/e.length;return Math.sqrt(s)}}class K{constructor(e){this.aggregator=e}generateDashboard(){const e=Object.values(l),t={overview:this.generateOverview(),indicators:[],trends:[],alerts:[]};return e.forEach(i=>{const s=this.aggregator.getAggregatedStats(i),r=this.aggregator.getTrendData(i,7);if(s){const n={indicator:i,name:this.getIndicatorName(i),category:this.getIndicatorCategory(i),current:s.average,benchmark:M[i],performance:this.calculateIndicatorPerformance(s.average,i),trend:this.calculateTrendDirection(r),stats:s};t.indicators.push(n);const a=this.checkQualityAlert(n);a&&t.alerts.push(a)}}),t.trends=this.generateTrendSummaries(),t}generateOverview(){const e=this.aggregator.metrics,t=e.filter(r=>new Date(r.timestamp)>new Date(Date.now()-24*60*60*1e3)),i=e.filter(r=>r.performance.score!==null).map(r=>r.performance.score),s=i.length>0?i.reduce((r,n)=>r+n,0)/i.length:0;return{totalMetrics:e.length,metricsLast24h:t.length,averagePerformance:Math.round(s),qualityLevel:this.getQualityLevel(s),lastUpdated:new Date().toISOString()}}getIndicatorName(e){return{[l.DOOR_TO_NEEDLE_TIME]:"Door-to-Needle Time",[l.DOOR_TO_IMAGING_TIME]:"Door-to-Imaging Time",[l.IMAGING_TO_DECISION_TIME]:"Imaging-to-Decision Time",[l.MORTALITY_RATE_30D]:"30-Day Mortality Rate",[l.FUNCTIONAL_INDEPENDENCE_90D]:"90-Day Functional Independence",[l.HEMORRHAGIC_TRANSFORMATION_RATE]:"Hemorrhagic Transformation Rate",[l.THROMBOLYSIS_RATE]:"Thrombolysis Rate",[l.MECHANICAL_THROMBECTOMY_RATE]:"Mechanical Thrombectomy Rate",[l.PREDICTION_ACCURACY]:"Prediction Accuracy",[l.MODEL_CALIBRATION]:"Model Calibration",[l.ALERT_APPROPRIATENESS]:"Alert Appropriateness",[l.GUIDELINE_ADHERENCE]:"Guideline Adherence"}[e]||e.replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}getIndicatorCategory(e){return{[l.DOOR_TO_NEEDLE_TIME]:m.PROCESS,[l.DOOR_TO_IMAGING_TIME]:m.PROCESS,[l.IMAGING_TO_DECISION_TIME]:m.EFFICIENCY,[l.MORTALITY_RATE_30D]:m.OUTCOME,[l.FUNCTIONAL_INDEPENDENCE_90D]:m.OUTCOME,[l.HEMORRHAGIC_TRANSFORMATION_RATE]:m.SAFETY,[l.THROMBOLYSIS_RATE]:m.PROCESS,[l.MECHANICAL_THROMBECTOMY_RATE]:m.PROCESS,[l.PREDICTION_ACCURACY]:m.EFFICIENCY,[l.MODEL_CALIBRATION]:m.EFFICIENCY,[l.ALERT_APPROPRIATENESS]:m.EFFICIENCY,[l.GUIDELINE_ADHERENCE]:m.PROCESS}[e]||m.PROCESS}calculateIndicatorPerformance(e,t){return new w(t,null,e,new Date().toISOString()).performance}calculateTrendDirection(e){if(!e||e.length<2)return{direction:"stable",change:0};const t=e.filter(a=>a.average!==null);if(t.length<2)return{direction:"stable",change:0};const i=t[t.length-1].average,s=t[t.length-2].average,r=(i-s)/s*100;let n;return Math.abs(r)<5?n="stable":r>0?n="improving":n="declining",{direction:n,change:Math.round(r*10)/10}}checkQualityAlert(e){const{performance:t,trend:i,indicator:s}=e;return t.level==="needs_improvement"?{type:"performance",severity:"high",indicator:s,message:`${e.name} performance is below acceptable threshold`,recommendation:"Review processes and implement improvement measures"}:i.direction==="declining"&&Math.abs(i.change)>15?{type:"trend",severity:"medium",indicator:s,message:`${e.name} showing declining trend (${i.change}%)`,recommendation:"Monitor closely and identify contributing factors"}:null}generateTrendSummaries(){const e=[];return Object.values(l).forEach(i=>{const s=this.aggregator.getTrendData(i,30);if(s){const r=this.analyzeTrend(i,s);r&&e.push(r)}}),e.sort((i,s)=>s.significance-i.significance)}analyzeTrend(e,t){const i=t.filter(a=>a.average!==null);if(i.length<7)return null;const s=i.map((a,c)=>({x:c,y:a.average})),r=this.calculateLinearRegression(s),n=Math.abs(r.slope)*i.length;return{indicator:e,name:this.getIndicatorName(e),slope:r.slope,correlation:r.correlation,significance:n,trend:r.slope>0?"improving":r.slope<0?"declining":"stable",dataPoints:i.length}}calculateLinearRegression(e){const t=e.length,i=e.reduce((f,p)=>f+p.x,0),s=e.reduce((f,p)=>f+p.y,0),r=e.reduce((f,p)=>f+p.x*p.y,0),n=e.reduce((f,p)=>f+p.x*p.x,0),a=e.reduce((f,p)=>f+p.y*p.y,0),c=(t*r-i*s)/(t*n-i*i),u=(s-c*i)/t,E=t*r-i*s,_=Math.sqrt((t*n-i*i)*(t*a-s*s)),D=_!==0?E/_:0;return{slope:c,intercept:u,correlation:D}}getQualityLevel(e){return e>=90?"excellent":e>=85?"good":e>=70?"acceptable":"needs_improvement"}}class F{constructor(){this.aggregator=new J,this.dashboard=new K(this.aggregator),this.collectors=new Map,this.isActive=!1,this.updateInterval=null}async initialize(){const e=v.startMeasurement(O.SYSTEM_STARTUP,"quality_metrics_init");try{this.registerMetricCollectors(),this.setupEventListeners(),this.startPeriodicCollection(),this.isActive=!0,v.endMeasurement(e,{success:!0}),g.publish(h.AUDIT_EVENT,{action:"quality_metrics_tracker_initialized",collectors:Array.from(this.collectors.keys())})}catch(t){throw v.endMeasurement(e,{success:!1,error:t.message}),t}}registerMetricCollectors(){this.collectors.set("door_to_needle_collector",{indicator:l.DOOR_TO_NEEDLE_TIME,category:m.PROCESS,collect:this.collectDoorToNeedleTime.bind(this)}),this.collectors.set("door_to_imaging_collector",{indicator:l.DOOR_TO_IMAGING_TIME,category:m.PROCESS,collect:this.collectDoorToImagingTime.bind(this)}),this.collectors.set("prediction_accuracy_collector",{indicator:l.PREDICTION_ACCURACY,category:m.EFFICIENCY,collect:this.collectPredictionAccuracy.bind(this)}),this.collectors.set("alert_appropriateness_collector",{indicator:l.ALERT_APPROPRIATENESS,category:m.EFFICIENCY,collect:this.collectAlertAppropriateness.bind(this)}),this.collectors.set("thrombolysis_rate_collector",{indicator:l.THROMBOLYSIS_RATE,category:m.PROCESS,collect:this.collectThrombolysisRate.bind(this)})}setupEventListeners(){g.subscribe(h.CLINICAL_ALERT,e=>{this.handleClinicalAlert(e)}),g.subscribe(h.PREDICTION_GENERATED,e=>{this.handlePredictionGenerated(e)}),g.subscribe(h.TREATMENT_DELIVERED,e=>{this.handleTreatmentDelivered(e)}),g.subscribe(h.PATIENT_OUTCOME,e=>{this.handlePatientOutcome(e)})}startPeriodicCollection(){this.updateInterval=setInterval(()=>{this.collectAllMetrics()},15*60*1e3),this.collectAllMetrics()}async collectAllMetrics(){const e=v.startMeasurement(O.DATA_PROCESSING,"collect_all_metrics");try{const t=Array.from(this.collectors.values()).map(async r=>{try{const n=await r.collect();if(n!=null){const a=new w(r.indicator,r.category,n,new Date().toISOString());return this.aggregator.addMetric(a),{indicator:r.indicator,value:n,success:!0}}}catch(n){return{indicator:r.indicator,error:n.message,success:!1}}return null}),s=(await Promise.allSettled(t)).filter(r=>{var n;return r.status==="fulfilled"&&((n=r.value)==null?void 0:n.success)});v.endMeasurement(e,{success:!0,metricsCollected:s.length})}catch(t){v.endMeasurement(e,{success:!1,error:t.message})}}recordMetric(e,t,i,s={}){const r=new w(e,t,i,new Date().toISOString(),s);return this.aggregator.addMetric(r),g.publish(h.AUDIT_EVENT,{action:"quality_metric_recorded",indicator:e,value:i,performance:r.performance}),r}getQualityDashboard(){return this.dashboard.generateDashboard()}getMetricStatistics(e){return this.aggregator.getAggregatedStats(e)}getTrendData(e,t=30){return this.aggregator.getTrendData(e,t)}exportQualityReport(e="json"){const t=this.getQualityDashboard(),i={timestamp:new Date().toISOString(),version:"1.0",dashboard:t,detailedMetrics:this.getDetailedMetrics()};switch(e){case"json":return JSON.stringify(i,null,2);case"csv":return this.convertToCSV(i);default:return i}}getDetailedMetrics(){const e=Object.values(l),t={};return e.forEach(i=>{const s=this.aggregator.getAggregatedStats(i),r=this.aggregator.getTrendData(i,30);s&&(t[i]={statistics:s,trends:r,benchmark:M[i]})}),t}async collectDoorToNeedleTime(){return Math.random()*40+30}async collectDoorToImagingTime(){return Math.random()*20+15}async collectPredictionAccuracy(){return Math.random()*20+80}async collectAlertAppropriateness(){return Math.random()*30+70}async collectThrombolysisRate(){return Math.random()*15+10}handleClinicalAlert(e){const t=this.assessAlertAppropriateness(e.alert);this.recordMetric(l.ALERT_APPROPRIATENESS,m.EFFICIENCY,t?100:0,{alertId:e.alert.id,alertType:e.alert.ruleId})}handlePredictionGenerated(e){var i,s,r;const t=((r=(s=(i=e.predictions)==null?void 0:i.mortality)==null?void 0:s.confidence)==null?void 0:r.percent)||0;this.recordMetric("prediction_confidence",m.EFFICIENCY,t,{patientId:e.patientId})}handleTreatmentDelivered(e){if(e.treatment==="thrombolysis"){const{doorToNeedleTime:t}=e;t&&this.recordMetric(l.DOOR_TO_NEEDLE_TIME,m.PROCESS,t,{patientId:e.patientId})}}handlePatientOutcome(e){e.outcome==="mortality_30d"&&this.recordMetric(l.MORTALITY_RATE_30D,m.OUTCOME,e.value?100:0,{patientId:e.patientId}),e.outcome==="functional_independence_90d"&&this.recordMetric(l.FUNCTIONAL_INDEPENDENCE_90D,m.OUTCOME,e.value?100:0,{patientId:e.patientId})}assessAlertAppropriateness(e){var t,i;return((t=e.severity)==null?void 0:t.level)==="critical"?Math.random()>.1:((i=e.severity)==null?void 0:i.level)==="high"?Math.random()>.2:Math.random()>.3}convertToCSV(e){const t=[["Indicator","Category","Current Value","Benchmark Target","Performance Level","Trend Direction"]];return e.dashboard.indicators.forEach(i=>{var s,r,n,a;t.push([i.name,i.category,((s=i.current)==null?void 0:s.toFixed(2))||"N/A",((r=i.benchmark)==null?void 0:r.target)||"N/A",((n=i.performance)==null?void 0:n.level)||"N/A",((a=i.trend)==null?void 0:a.direction)||"N/A"])}),t.map(i=>i.join(",")).join(`
`)}getQualityTrendsSummary(e=30){const t={period:`${e} days`,overallTrend:"stable",improvingIndicators:[],decliningIndicators:[],stableIndicators:[]};return Object.values(l).forEach(s=>{const r=this.aggregator.getTrendData(s,e);if(r){const n=this.dashboard.calculateTrendDirection(r),a={indicator:s,name:this.dashboard.getIndicatorName(s),direction:n.direction,change:n.change};n.direction==="improving"?t.improvingIndicators.push(a):n.direction==="declining"?t.decliningIndicators.push(a):t.stableIndicators.push(a)}}),t.improvingIndicators.length>t.decliningIndicators.length?t.overallTrend="improving":t.decliningIndicators.length>t.improvingIndicators.length&&(t.overallTrend="declining"),t}stop(){this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.isActive=!1,g.publish(h.AUDIT_EVENT,{action:"quality_metrics_tracker_stopped"})}dispose(){this.stop(),this.collectors.clear(),this.aggregator.metrics.length=0,this.aggregator.aggregations.clear(),this.aggregator.trends.clear(),g.publish(h.AUDIT_EVENT,{action:"quality_metrics_tracker_disposed"})}}const W=new F,ue=Object.freeze(Object.defineProperty({__proto__:null,ClinicalIndicators:l,QualityBenchmarks:M,QualityCategories:m,QualityMetricsTracker:F,qualityMetricsTracker:W},Symbol.toStringTag,{value:"Module"})),d={USER_LOGIN:"user_login",USER_LOGOUT:"user_logout",PATIENT_ACCESS:"patient_access",DATA_ENTRY:"data_entry",DATA_MODIFICATION:"data_modification",PREDICTION_GENERATED:"prediction_generated",ALERT_TRIGGERED:"alert_triggered",ALERT_ACKNOWLEDGED:"alert_acknowledged",TREATMENT_RECOMMENDED:"treatment_recommended",REPORT_GENERATED:"report_generated",DATA_EXPORT:"data_export",SYSTEM_ERROR:"system_error",CONFIGURATION_CHANGE:"configuration_change",MODEL_PREDICTION:"model_prediction",QUALITY_METRIC:"quality_metric",CLINICAL_DECISION:"clinical_decision"},T={INFO:"info",WARNING:"warning",ERROR:"error",CRITICAL:"critical"},y={HIPAA:"hipaa",GDPR:"gdpr",FDA_21CFR11:"fda_21cfr11",IEC_62304:"iec_62304",ISO_27001:"iso_27001"};class Z{constructor(e,t={}){this.id=`audit_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,this.timestamp=new Date().toISOString(),this.eventType=e,this.severity=t.severity||T.INFO,this.userId=t.userId||"system",this.sessionId=t.sessionId||null,this.patientId=t.patientId||null,this.ipAddress=t.ipAddress||this.getClientIP(),this.userAgent=t.userAgent||navigator.userAgent,this.module=t.module||null,this.action=t.action||null,this.resource=t.resource||null,this.oldValue=t.oldValue||null,this.newValue=t.newValue||null,this.outcome=t.outcome||"success",this.errorMessage=t.errorMessage||null,this.metadata=t.metadata||{},this.compliance=this.determineComplianceRequirements(e),this.hash=this.calculateHash()}getClientIP(){return"127.0.0.1"}determineComplianceRequirements(e){const t=[];return[d.PATIENT_ACCESS,d.DATA_ENTRY,d.DATA_MODIFICATION,d.DATA_EXPORT,d.REPORT_GENERATED].includes(e)&&t.push(y.HIPAA),[d.DATA_ENTRY,d.DATA_MODIFICATION,d.REPORT_GENERATED,d.CLINICAL_DECISION].includes(e)&&t.push(y.FDA_21CFR11),[d.PREDICTION_GENERATED,d.MODEL_PREDICTION,d.SYSTEM_ERROR,d.CONFIGURATION_CHANGE].includes(e)&&t.push(y.IEC_62304),t}calculateHash(){const e=JSON.stringify({timestamp:this.timestamp,eventType:this.eventType,userId:this.userId,action:this.action,resource:this.resource,outcome:this.outcome});let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t&=t}return Math.abs(t).toString(16)}sanitize(){const e={...this};return e.patientId&&(e.patientId=this.hashSensitiveData(e.patientId)),e.oldValue&&typeof e.oldValue=="object"&&(e.oldValue=this.sanitizeObject(e.oldValue)),e.newValue&&typeof e.newValue=="object"&&(e.newValue=this.sanitizeObject(e.newValue)),e}hashSensitiveData(e){return`hash_${e.toString().length}_${Date.now().toString(36)}`}sanitizeObject(e){const t={...e};return["name","ssn","address","phone","email"].forEach(s=>{t[s]&&(t[s]="[REDACTED]")}),t}exportForCompliance(e){const t={eventId:this.id,timestamp:this.timestamp,eventType:this.eventType,userId:this.userId,outcome:this.outcome,hash:this.hash};switch(e){case y.HIPAA:return{...t,patientId:this.patientId?"[PROTECTED]":null,accessType:this.action,reasonForAccess:this.metadata.reason||"Clinical care",minimalNecessary:!0};case y.FDA_21CFR11:return{...t,electronicSignature:this.metadata.signature||null,recordIntegrity:this.hash,auditTrailComplete:!0,dataModification:{old:this.oldValue?"[RECORDED]":null,new:this.newValue?"[RECORDED]":null}};case y.IEC_62304:return{...t,softwareVersion:this.metadata.version||"1.0",riskClass:this.metadata.riskClass||"B",safetyRequirement:this.metadata.safetyRequirement||null,traceabilityId:this.metadata.traceabilityId||null};default:return t}}}class ee{constructor(){this.events=[],this.indices=new Map,this.maxEvents=1e4,this.retentionPeriod=7*365*24*60*60*1e3}store(e){this.events.push(e),this.updateIndices(e),this.maintainStorageSize(),this.persistEvent(e)}updateIndices(e){this.indices.has("eventType")||this.indices.set("eventType",new Map);const t=this.indices.get("eventType");t.has(e.eventType)||t.set(e.eventType,[]),t.get(e.eventType).push(e.id),this.indices.has("userId")||this.indices.set("userId",new Map);const i=this.indices.get("userId");if(i.has(e.userId)||i.set(e.userId,[]),i.get(e.userId).push(e.id),e.patientId){this.indices.has("patientId")||this.indices.set("patientId",new Map);const n=this.indices.get("patientId");n.has(e.patientId)||n.set(e.patientId,[]),n.get(e.patientId).push(e.id)}const s=e.timestamp.split("T")[0];this.indices.has("date")||this.indices.set("date",new Map);const r=this.indices.get("date");r.has(s)||r.set(s,[]),r.get(s).push(e.id)}maintainStorageSize(){if(this.events.length>this.maxEvents){const t=this.events.length-this.maxEvents;this.events.splice(0,t).forEach(s=>{this.removeFromIndices(s)})}const e=new Date(Date.now()-this.retentionPeriod);this.events=this.events.filter(t=>{const s=new Date(t.timestamp)>e;return s||this.removeFromIndices(t),s})}removeFromIndices(e){const t=this.indices.get("eventType");if(t&&t.has(e.eventType)){const n=t.get(e.eventType),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}const i=this.indices.get("userId");if(i&&i.has(e.userId)){const n=i.get(e.userId),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}if(e.patientId){const n=this.indices.get("patientId");if(n&&n.has(e.patientId)){const a=n.get(e.patientId),c=a.indexOf(e.id);c>-1&&a.splice(c,1)}}const s=e.timestamp.split("T")[0],r=this.indices.get("date");if(r&&r.has(s)){const n=r.get(s),a=n.indexOf(e.id);a>-1&&n.splice(a,1)}}async persistEvent(e){try{const t=e.sanitize();await H.set(`audit_${e.id}`,t,24*60*60*1e3)}catch(t){}}search(e){let t=new Set,i=!0;Object.entries(e).forEach(([r,n])=>{const a=this.indices.get(r);if(a&&a.has(n)){const c=new Set(a.get(n));i?(t=c,i=!1):t=new Set([...t].filter(u=>c.has(u)))}else i?(t=new Set,i=!1):t=new Set});const s=this.events.filter(r=>t.has(r.id));return this.applyAdditionalFilters(s,e)}applyAdditionalFilters(e,t){let i=e;if(t.startDate){const s=new Date(t.startDate);i=i.filter(r=>new Date(r.timestamp)>=s)}if(t.endDate){const s=new Date(t.endDate);i=i.filter(r=>new Date(r.timestamp)<=s)}if(t.severity&&(i=i.filter(s=>s.severity===t.severity)),t.outcome&&(i=i.filter(s=>s.outcome===t.outcome)),t.textSearch){const s=t.textSearch.toLowerCase();i=i.filter(r=>{var n,a,c;return((n=r.action)==null?void 0:n.toLowerCase().includes(s))||((a=r.resource)==null?void 0:a.toLowerCase().includes(s))||((c=r.errorMessage)==null?void 0:c.toLowerCase().includes(s))})}return i.sort((s,r)=>new Date(r.timestamp)-new Date(s.timestamp))}getCount(){return this.events.length}getStatistics(){const e={},t={},i={};return this.events.forEach(s=>{e[s.eventType]=(e[s.eventType]||0)+1,t[s.severity]=(t[s.severity]||0)+1;const r=s.timestamp.split("T")[0];i[r]=(i[r]||0)+1}),{totalEvents:this.events.length,eventsByType:e,eventsBySeverity:t,eventsByDay:i,oldestEvent:this.events.length>0?this.events[0].timestamp:null,newestEvent:this.events.length>0?this.events[this.events.length-1].timestamp:null}}}class G{constructor(){this.storage=new ee,this.isActive=!1,this.currentSession=null,this.automaticEvents=new Set([h.PREDICTION_GENERATED,h.CLINICAL_ALERT,h.FORM_UPDATED,h.AUDIT_EVENT])}async initialize(){const e=v.startMeasurement(O.SYSTEM_STARTUP,"audit_trail_init");try{this.setupEventListeners(),this.startSession(),this.isActive=!0,v.endMeasurement(e,{success:!0}),this.logEvent(d.CONFIGURATION_CHANGE,{action:"audit_trail_initialized",resource:"audit_system",metadata:{version:"1.0",riskClass:"B",safetyRequirement:"Clinical decision audit logging"}})}catch(t){throw v.endMeasurement(e,{success:!1,error:t.message}),t}}setupEventListeners(){this.automaticEvents.forEach(e=>{g.subscribe(e,t=>{this.handleAutomaticEvent(e,t)})}),document.addEventListener("submit",e=>{this.handleFormSubmission(e)}),window.addEventListener("beforeunload",()=>{this.logEvent(d.USER_LOGOUT,{action:"session_ended",resource:"application"})}),window.addEventListener("error",e=>{var t;this.logEvent(d.SYSTEM_ERROR,{severity:T.ERROR,action:"javascript_error",resource:e.filename||"unknown",errorMessage:e.message,metadata:{line:e.lineno,column:e.colno,stack:(t=e.error)==null?void 0:t.stack}})})}startSession(){this.currentSession={id:`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,startTime:new Date().toISOString(),userId:"clinical_user",events:[]},this.logEvent(d.USER_LOGIN,{action:"session_started",resource:"application",sessionId:this.currentSession.id})}logEvent(e,t={}){if(this.isActive)try{this.currentSession&&(t.sessionId=this.currentSession.id,t.userId=t.userId||this.currentSession.userId);const i=new Z(e,t);return this.storage.store(i),this.currentSession&&this.currentSession.events.push(i.id),(i.severity===T.CRITICAL||i.severity===T.ERROR)&&this.notifyCriticalEvent(i),i.id}catch(i){return null}}handleAutomaticEvent(e,t){var i,s,r,n,a,c,u,E,_;switch(e){case h.PREDICTION_GENERATED:this.logEvent(d.PREDICTION_GENERATED,{action:"prediction_generated",resource:"predictive_engine",patientId:t.patientId,metadata:{predictions:Object.keys(t.predictions||{}),confidence:(r=(s=(i=t.predictions)==null?void 0:i.mortality)==null?void 0:s.confidence)==null?void 0:r.level}});break;case h.CLINICAL_ALERT:this.logEvent(d.ALERT_TRIGGERED,{severity:((a=(n=t.alert)==null?void 0:n.severity)==null?void 0:a.level)==="critical"?T.CRITICAL:T.WARNING,action:t.action==="activated"?"alert_triggered":"alert_acknowledged",resource:"clinical_decision_support",patientId:(c=t.alert)==null?void 0:c.patientId,metadata:{alertId:(u=t.alert)==null?void 0:u.id,alertType:(E=t.alert)==null?void 0:E.ruleId,alertTitle:(_=t.alert)==null?void 0:_.title}});break;case h.FORM_UPDATED:this.logEvent(d.DATA_ENTRY,{action:"form_data_updated",resource:`form_${t.module}`,patientId:t.patientId,metadata:{module:t.module,fieldsUpdated:Object.keys(t.formData||{})}});break}}handleFormSubmission(e){const t=e.target;if(t.dataset.module){const i=new FormData(t),s=Object.fromEntries(i.entries());this.logEvent(d.CLINICAL_DECISION,{action:"clinical_assessment_submitted",resource:`module_${t.dataset.module}`,metadata:{module:t.dataset.module,fieldsSubmitted:Object.keys(s),timestamp:new Date().toISOString()}})}}logDataModification(e,t,i,s={}){return this.logEvent(d.DATA_MODIFICATION,{action:"data_modified",resource:e,oldValue:t,newValue:i,patientId:s.patientId,metadata:{reason:s.reason||"Clinical update",signature:s.signature}})}logReportGeneration(e,t,i={}){return this.logEvent(d.REPORT_GENERATED,{action:"clinical_report_generated",resource:`report_${e}`,patientId:t,metadata:{reportType:e,format:i.format||"html",recipient:i.recipient,reason:i.reason||"Clinical documentation"}})}logDataExport(e,t,i={}){return this.logEvent(d.DATA_EXPORT,{severity:T.WARNING,action:"data_exported",resource:`export_${e}`,metadata:{dataType:e,format:t,recordCount:i.recordCount,recipient:i.recipient,purpose:i.purpose||"Clinical analysis"}})}searchEvents(e){return this.storage.search(e)}getPatientAuditTrail(e,t={}){const i={patientId:e,startDate:t.startDate,endDate:t.endDate};return this.storage.search(i)}getUserAuditTrail(e,t={}){const i={userId:e,startDate:t.startDate,endDate:t.endDate};return this.storage.search(i)}generateComplianceReport(e,t={}){const s=this.storage.search({startDate:t.startDate,endDate:t.endDate}).filter(n=>n.compliance.includes(e)),r={framework:e,reportPeriod:{start:t.startDate||"N/A",end:t.endDate||"N/A"},totalEvents:s.length,events:s.map(n=>n.exportForCompliance(e)),summary:this.generateComplianceSummary(s,e),generatedAt:new Date().toISOString()};return this.logEvent(d.REPORT_GENERATED,{action:"compliance_report_generated",resource:`compliance_${e}`,metadata:{framework:e,eventCount:s.length,period:r.reportPeriod}}),r}generateComplianceSummary(e,t){const i={totalEvents:e.length,eventsByType:{},eventsBySeverity:{},complianceMetrics:{}};switch(e.forEach(s=>{i.eventsByType[s.eventType]=(i.eventsByType[s.eventType]||0)+1,i.eventsBySeverity[s.severity]=(i.eventsBySeverity[s.severity]||0)+1}),t){case y.HIPAA:i.complianceMetrics={patientAccesses:i.eventsByType[d.PATIENT_ACCESS]||0,dataExports:i.eventsByType[d.DATA_EXPORT]||0,unauthorizedAttempts:e.filter(s=>s.outcome==="failure").length};break;case y.FDA_21CFR11:i.complianceMetrics={electronicRecords:i.eventsByType[d.DATA_ENTRY]||0,recordModifications:i.eventsByType[d.DATA_MODIFICATION]||0,signedRecords:e.filter(s=>{var r;return(r=s.metadata)==null?void 0:r.signature}).length};break;case y.IEC_62304:i.complianceMetrics={softwareEvents:i.eventsByType[d.MODEL_PREDICTION]||0,systemErrors:i.eventsByType[d.SYSTEM_ERROR]||0,configurationChanges:i.eventsByType[d.CONFIGURATION_CHANGE]||0};break}return i}verifyIntegrity(){const e={totalEvents:this.storage.getCount(),verified:0,failed:0,issues:[]};return this.storage.events.forEach(t=>{const i=t.calculateHash();t.hash===i?e.verified++:(e.failed++,e.issues.push({eventId:t.id,timestamp:t.timestamp,issue:"Hash mismatch - possible tampering"}))}),this.logEvent(d.CONFIGURATION_CHANGE,{action:"integrity_verification",resource:"audit_trail",outcome:e.failed===0?"success":"warning",metadata:{verified:e.verified,failed:e.failed,totalChecked:e.totalEvents}}),e}exportAuditTrail(e="json",t={}){const i=this.storage.search({startDate:t.startDate,endDate:t.endDate,eventType:t.eventType,userId:t.userId,patientId:t.patientId}),s={metadata:{exportedAt:new Date().toISOString(),totalEvents:i.length,period:{start:t.startDate||"beginning",end:t.endDate||"now"},filters:t},events:i.map(r=>r.sanitize())};switch(this.logDataExport("audit_trail",e,{recordCount:i.length,purpose:t.purpose||"Compliance audit"}),e){case"json":return JSON.stringify(s,null,2);case"csv":return this.convertToCSV(s.events);case"xml":return this.convertToXML(s);default:return s}}convertToCSV(e){if(e.length===0)return"";const i=[["Timestamp","Event Type","User ID","Action","Resource","Outcome","Severity"]];return e.forEach(s=>{i.push([s.timestamp,s.eventType,s.userId,s.action||"",s.resource||"",s.outcome,s.severity])}),i.map(s=>s.map(r=>`"${r}"`).join(",")).join(`
`)}convertToXML(e){let t=`<?xml version="1.0" encoding="UTF-8"?>
`;return t+=`<auditTrail>
`,t+=`  <metadata>
`,t+=`    <exportedAt>${e.metadata.exportedAt}</exportedAt>
`,t+=`    <totalEvents>${e.metadata.totalEvents}</totalEvents>
`,t+=`  </metadata>
`,t+=`  <events>
`,e.events.forEach(i=>{t+=`    <event>
`,t+=`      <id>${i.id}</id>
`,t+=`      <timestamp>${i.timestamp}</timestamp>
`,t+=`      <eventType>${i.eventType}</eventType>
`,t+=`      <userId>${i.userId}</userId>
`,t+=`      <action>${i.action||""}</action>
`,t+=`      <resource>${i.resource||""}</resource>
`,t+=`      <outcome>${i.outcome}</outcome>
`,t+=`      <severity>${i.severity}</severity>
`,t+=`    </event>
`}),t+=`  </events>
`,t+="</auditTrail>",t}notifyCriticalEvent(e){g.publish(h.CLINICAL_ALERT,{alert:{id:`audit_${e.id}`,severity:{level:"critical",icon:"üö®"},title:"Critical Audit Event",message:`${e.eventType}: ${e.action}`,recommendation:"Review audit event immediately"},action:"activated"})}getStatistics(){return this.storage.getStatistics()}getCurrentSession(){return this.currentSession}stop(){this.currentSession&&this.logEvent(d.USER_LOGOUT,{action:"audit_system_stopped",resource:"audit_system"}),this.isActive=!1}dispose(){this.stop(),this.storage.events.length=0,this.storage.indices.clear(),this.currentSession=null}}const te=new G,me=Object.freeze(Object.defineProperty({__proto__:null,AuditEventTypes:d,AuditSeverity:T,ClinicalAuditTrail:G,ComplianceFrameworks:y,clinicalAuditTrail:te},Symbol.toStringTag,{value:"Module"}));export{ce as a,le as b,ne as c,te as d,X as e,de as f,ue as g,me as h,Y as i,W as q,oe as r,ae as s};
//# sourceMappingURL=research-tools-Dhw3wGGU.js.map
